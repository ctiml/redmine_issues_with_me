<%
  # FIXME: logic in view
  user_id = User.current.id
  issue_ids = Journal.select('journalized_id').where(user_id: user_id).where(journalized_type: "Issue").collect{|j|j.journalized_id}.uniq
  issues = Issue.find issue_ids
%>
<h3><%=l(:label_issues_with_me)%> (<%= issues.count %>)</h3>

<% assigned_issues = issuesassignedtome_items %>
<%= render :partial => 'issues/list_simple', :locals => { :issues => issues } %>
<% if assigned_issues.length > 0 %>
<p class="small"><%= link_to l(:label_issue_view_all), :controller => 'issues',
                                                       :action => 'index',
                                                       :set_filter => 1,
                                                       :assigned_to_id => 'me',
                                                       :sort => 'priority:desc,updated_on:desc' %></p>
<% end %>

<% content_for :header_tags do %>
<%= auto_discovery_link_tag(:atom,
                            {:controller => 'issues', :action => 'index', :set_filter => 1,
                             :assigned_to_id => 'me', :format => 'atom', :key => User.current.rss_key},
                            {:title => l(:label_assigned_to_me_issues)}) %>
<% end %>
